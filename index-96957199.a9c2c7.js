(self.webpackChunkarcomage_hd=self.webpackChunkarcomage_hd||[]).push([[2421],{1750:function(e,p,o){"use strict";o.d(p,{Z:function(){return P}});var t=o(4454),n=o(3211),i=o(6008),s=o(3825),y=o(3251),r=o(1558),a=o(1757),f=o(1159),l=o(6353),u=o(8170),d=o(6559),c=o(583),O=o(1304),T=o(8763),h=o(5022),g=o(5631),U=o(1317);const w=[-2,-3,-4];var R=o(5078),b=o(3644),m=o(7746),z=o(4370);const M=[-2,-3,-4];var x=o(6187);const E={lose:"defeat",tie:"victory",win:"victory"};var k=o(5863),v=o(898),P=(0,t.l)(((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.g$)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=p.payload.map((e=>{const{isPlayer:p,statusProp:t,noSound:n}=e;let i=null;if("to"in e){const n=o.status[p?"player":"opponent"][t];e.to!==n&&(i=e.to>n)}else 0!==e.diff&&(i=e.diff>0);return n||(0,f.Z)(t,o.volume,i),Object.assign({isPlayer:p,statusProp:t},"to"in e?{to:e.to}:{diff:e.diff})}));return(0,l.z)((0,u.of)({type:n.l7,payload:t}),(0,u.of)({type:n.Qo}),(0,u.of)({type:n.Dt})).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.Uk)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=o.status.player,i=o.status.opponent,s=Object.assign({},t),y=Object.assign({},i),a=c.Z[p.n],f="player"===p.owner?s:y,l=O.ag[a.type];f[l]-=a.cost;const T=f[l],h=a.effect;"player"===p.owner?h(s,y):h(y,s);const g=(0,d.qh)(s).filter((([e,p])=>p!==t[e])).map((([e,o])=>({isPlayer:!0,statusProp:e,to:o,noSound:"player"===p.owner&&e===l&&o===T}))).concat((0,d.qh)(y).filter((([e,p])=>p!==i[e])).map((([e,o])=>({isPlayer:!1,statusProp:e,to:o,noSound:"opponent"===p.owner&&e===l&&o===T}))));return(0,u.of)({type:n.g$,payload:g}).pipe((0,r.R)(e.ofType(n.OU)))})))),T.Z,((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.fL)),(0,s.M)(p),(0,y.b)((([{index:p,position:o,owner:t},i])=>((0,f.Z)("deal",i.volume),(0,l.z)(i.game.isNewTurn?(0,u.of)({type:n.kH}):g.E,(0,u.of)({type:n.iE,index:p}),(0,u.of)({type:n.Jn,index:p}).pipe((0,h.g)(0)),(0,u.of)({type:n.fj,index:p,position:o,owner:t}),i.game.discardMode?(0,l.z)((0,u.of)({type:n.vd,on:!1}),(0,u.of)({type:n.NX})).pipe((0,r.R)(e.ofType(n.OU))):(0,l.z)((0,u.of)({type:n.Ut,on:!0}),(0,u.of)({type:n.jV}).pipe((0,h.g)(U.RE))).pipe((0,r.R)(e.ofType(n.OU)))).pipe((0,r.R)(e.ofType(n.OU)))))))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.Jn)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=o.cards.list,i=t[p.index];if(null!==i&&!1===w.includes(i.position)){const o=w.find((e=>t.every((p=>(null==p?void 0:p.position)!==e))));return void 0===o?(0,l.z)((0,u.of)({type:n.kH}),(0,u.of)({type:n.Jn,index:p.index})).pipe((0,r.R)(e.ofType(n.OU))):(0,u.of)({type:n._d,index:p.index,toPosition:o}).pipe((0,r.R)(e.ofType(n.OU)))}return g.E})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.ah)),(0,y.b)((({payload:e})=>(0,l.z)((0,u.of)({type:n.OU}),(0,u.of)({type:n.MO,payload:e}),(0,u.of)({type:n.qg})))))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.qg)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=Math.random()<.5,i=o.settings.cardsInHand,s={total:{player:i,opponent:i},list:[],nextPos:{player:i,opponent:i}};for(let e=0,p=2*i;e<p;e++){const p={position:e%i,n:(0,R.d)(),unusable:!1,discarded:!1,isFlipped:!1,zeroOpacity:!1,owner:e<i?"player":"opponent"};s.list.push(p)}return(0,l.z)((0,u.of)({type:n.zn,payload:s}),(0,u.of)({type:n.s3,playersTurn:t}),(0,u.of)({type:n.F5,payload:o.settings.start}),(0,u.of)({type:n.k4,owner:t?"player":"opponent"}),(0,u.of)({type:n.NX}).pipe((0,h.g)(0))).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.NX)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=(0,R.d)(),i=o.game.playersTurn?"player":"opponent";return(0,f.Z)("deal",o.volume),(0,l.z)((0,u.of)({type:n.Ut,on:!0,locknumber:1}),(0,u.of)({type:n.$Z,n:t}),(0,u.of)({type:n.Qo,lastOnly:!0}),(0,u.of)({type:n.B4,owner:i}).pipe((0,h.g)(U.Fi)),(0,u.of)({type:n.Ut,on:!1,locknumber:1}).pipe((0,h.g)(0)),"opponent"===i&&b.Hz?(0,u.of)({type:n.zL}).pipe((0,h.g)(U.RE+U.CF+(b.G1?0:b.kQ)),(0,r.R)(e.ofType(n.OU))):g.E,"player"===i?(0,u.of)({type:n.yh}).pipe((0,h.g)(0),(0,r.R)(e.ofType(n.OU))):g.E).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.jV)),(0,s.M)(p),(0,y.b)((([p,o])=>(0,l.z)((0,u.of)({type:n.K5}),(0,u.of)({type:n.k4,owner:o.game.playersTurn?"opponent":"player"}),(0,u.of)({type:n.Ut,on:!1}),(0,u.of)({type:n.NX}).pipe((0,h.g)(0)),(0,u.of)({type:n.Z$,on:!0})).pipe((0,r.R)(e.ofType(n.OU))))))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.k4)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=o.status[p.owner],i=(0,d.qh)(O.cs).map((([e,o])=>({isPlayer:"player"===p.owner,statusProp:o,diff:t[e],noSound:!0})));return(0,u.of)({type:n.g$,payload:i}).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.kH)),(0,s.M)(p),(0,m.zg)((([p,o])=>{const t=[],i=[],s=[];return M.forEach((e=>{o.cards.list.forEach(((p,o)=>{null!==p&&p.position===e&&(t.push((0,u.of)({type:n.EK,index:o})),i.push((0,u.of)({type:n.OK,index:o}).pipe((0,h.g)(U.RE))),s.push((0,u.of)({type:n.M2,index:o}).pipe((0,h.g)(2*U.RE))))}))})),(0,z.T)((0,u.of)({type:n.Z$,on:!1}),(0,z.T)(...t,...i,...s)).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.Qo)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=[],i=[],s=(e,n)=>{if(null!==e){const s=p.lastOnly?o.game.playersTurn?"player":"opponent":e.owner;if("common"!==s){const{type:p,cost:y}=c.Z[e.n];o.status[s][O.ag[p]]<y?e.unusable||t.push(n):e.unusable&&i.push(n)}}};if(p.lastOnly){const e=o.cards.list,p=e.length-1;s(e[p],p)}else o.cards.list.forEach(s);return(0,u.of)({type:n.R9,unusables:t,usables:i}).pipe((0,r.R)(e.ofType(n.OU)))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.Dt)),(0,s.M)(p),(0,y.b)((([p,o])=>{const{tower:t,resource:i}=o.settings.win,{player:s,opponent:y}=o.status,a=s.tower>=t||y.tower<=0||O.ag.some((e=>s[e]>=i)),f=y.tower>=t||s.tower<=0||O.ag.some((e=>y[e]>=i));return a&&!f?(0,u.of)({type:n.Wz,payload:{type:"win"}}).pipe((0,r.R)(e.ofType(n.OU))):!a&&f?(0,u.of)({type:n.Wz,payload:{type:"lose"}}).pipe((0,r.R)(e.ofType(n.OU))):a&&f?(0,u.of)({type:n.Wz,payload:{type:"tie"}}).pipe((0,r.R)(e.ofType(n.OU))):g.E})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.Wz)),(0,s.M)(p),(0,y.b)((([e,p])=>{const{payload:o}=e;return(0,x.U)(o)&&(0,f.Z)(E[o.type],p.volume),(0,l.z)((0,u.of)({type:n.OU}),(0,u.of)({type:n.SO,payload:o}))})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.zL)),(0,s.M)(p),(0,y.b)((([p,o])=>{const t=(0,k.ai)(o);if(null===t)return(0,u.of)({type:n.Wz,payload:{type:"win",surrender:!0}}).pipe((0,r.R)(e.ofType(n.OU)));const{index:i,use:s}=t,y=o.cards.list[i];if(null!==y&&"common"!==y.owner){const{n:p,position:o,owner:t}=y;return s?(0,u.of)({type:n.u3,index:i,n:p,position:o,owner:t}).pipe((0,r.R)(e.ofType(n.OU))):(0,u.of)({type:n.fL,index:i,position:o,owner:t}).pipe((0,r.R)(e.ofType(n.OU)))}return g.E})))),((e,p)=>e.pipe((0,i.h)((0,a.isOfType)(n.yh)),(0,s.M)(p),(0,y.b)((([p,o])=>0===(0,v.Z)(o,"player").filter((e=>e.canuse||e.candiscard)).length?(0,u.of)({type:n.Wz,payload:{type:"lose",surrender:!0}}).pipe((0,r.R)(e.ofType(n.OU))):g.E)))))}}]);