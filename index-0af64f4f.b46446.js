(self.webpackChunkarcomage_hd=self.webpackChunkarcomage_hd||[]).push([[8761],{17474:function(e,p,o){"use strict";o.d(p,{Z:function(){return ie}});var t=o(84454),n=o(47515),i=o(77102),r=o(40706),y=o(23201),s=o(94132),a=o(63211),f=o(66008),l=o(43825),u=o(47746),d=o(1558),g=o(91757),c=o(96559),m=o(90583),O=o(91304),T=o(18170),Z=o(6353),w=o(5631),h=o(13875),z=o(66324),b=o(13068),x=o(26738),v=o(16306),N=o(17750),R=o(80127),U=o(55022),E=o(55760),M=o(55709),k=o(51015),S=o(71159),q=o(81317);const P=[-2,-3,-4];var $=o(76320),j=o(67032),H=o(5078),J=o(77456),B=o(23644),_=o(6709),C=o(14370);const D=[-2,-3,-4];var X=o(78373),I=o(74206),W=o(55863),L=o(40898),F=o(84694),G=o(87878),Y=o(37365),A=o(78410),K=o(27360),Q=o(10228),V=o(10441),ee=o(74555),pe=o(92087),oe=o(62884),te=o(60751),ne=o(29970),ie=(0,t.l)(n.Z,i.Z,r.Z,y.Z,s.Z,((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.Uk)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t=o.status.player,n=o.status.opponent,i=Object.assign({},t),r=Object.assign({},n),y=m.Z[p.n],s="player"===p.owner?i:r,f=O.ag[y.type];s[f]-=y.cost;const l=s[f],u=y.effect;"player"===p.owner?u(i,r):u(r,i);const g=(0,c.qh)(i).filter((([e,p])=>p!==t[e])).map((([e,o])=>({isPlayer:!0,statusProp:e,to:o,noSound:"player"===p.owner&&e===f&&o===l}))).concat((0,c.qh)(r).filter((([e,p])=>p!==n[e])).map((([e,o])=>({isPlayer:!1,statusProp:e,to:o,noSound:"opponent"===p.owner&&e===f&&o===l}))));return(0,T.of)({type:a.g$,payload:g}).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.qr)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{n:t,index:n,position:i,owner:r}=p,y=o.multiplayer.gameNumber;return(0,Z.z)((0,T.of)({type:a.xZ,payload:{type:a.ao,n:t,index:n,position:i,owner:r}}),y>0?(0,T.of)({type:a.H8,kind:h.d,data:{type:a.u3,payload:{type:a.ao,n:t,index:n,position:i,owner:(0,z._w)(r)}}}):w.E).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.u3)),(0,b.b)((e=>{const{payload:p,gameNumber:o}=e;if(void 0===o)return void(0,N.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let t=v.PB.get(o);void 0===t&&(t=new R.Z,v.PB.set(o,t)),t.enqueue(p)})),(0,x.l)())),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.tI)),(0,l.M)(p),(0,u.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,N.Z)(`play card from queue: ${n.toString()}`,"info");let i=v.PB.get(n);void 0===i&&(i=new R.Z,v.PB.set(n,i));const r=i.dequeueAsync();return(0,E.D)(r).pipe((0,l.M)(p),(0,u.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,T.of)({type:a.xZ,payload:e}).pipe((0,U.g)(0)):w.E)),(0,d.R)(e.ofType(a.Cv)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.xZ)),(0,l.M)(p),(0,u.zg)((([o,t])=>{const{payload:n}=o;return t.game.locked.some((e=>!0===e))?((0,N.Z)(`${JSON.stringify(n)} executed during the lock ${JSON.stringify(t.game.locked)}. the game will try to fix that`,"warning"),p.pipe((0,M.U)((e=>e.game.locked)),(0,f.h)((e=>!e.some((e=>!0===e)))),(0,k.q)(1),(0,M.U)((()=>n)),(0,d.R)(e.ofType(a.Cv)))):(0,T.of)(n)})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.ao)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{n:t,index:n,position:i,owner:r}=p,y=m.Z[t].special;return(0,S.Z)("deal",o.volume),(0,Z.z)(o.game.isNewTurn?(0,T.of)({type:a.kH}):w.E,(0,T.of)({type:a.Uk,n:t,owner:r}),(0,T.of)({type:a.PX,index:n}),(0,T.of)({type:a.fj,index:n,position:i,owner:r}),(0,T.of)({type:a.Ut,on:!0}),(null==y?void 0:y.drawDiscardPlayagain)?(0,Z.z)((0,T.of)({type:a.vd,on:!0}),(0,T.of)({type:a.NX}).pipe((0,U.g)(0)),(0,T.of)({type:a.Jn,index:n}).pipe((0,U.g)(q.RE+q.Oz)),(0,T.of)({type:a.Ut,on:!1})):(0,Z.z)((0,T.of)({type:a.Jn,index:n}).pipe((0,U.g)(q.RE+q.Oz)),(null==y?void 0:y.playagain)?(0,Z.z)((0,T.of)({type:a.NX}).pipe((0,U.g)(0)),(0,T.of)({type:a.Ut,on:!1})):(0,T.of)({type:a.jV}).pipe((0,U.g)(q.RE)))).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.fL)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{index:t,position:n,owner:i}=p,r=o.multiplayer.gameNumber;return(0,Z.z)((0,T.of)({type:a.xZ,payload:{type:a.xr,index:t,position:n,owner:i}}),r>0?(0,T.of)({type:a.H8,kind:h.d,data:{type:a.u3,payload:{type:a.xr,index:t,position:n,owner:(0,z._w)(i)}}}):w.E).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.xr)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{index:t,position:n,owner:i}=p;return(0,S.Z)("deal",o.volume),(0,Z.z)(o.game.isNewTurn?(0,T.of)({type:a.kH}):w.E,(0,T.of)({type:a.iE,index:t}),(0,T.of)({type:a.Jn,index:t}).pipe((0,U.g)(0)),(0,T.of)({type:a.fj,index:t,position:n,owner:i}),o.game.discardMode?(0,Z.z)((0,T.of)({type:a.vd,on:!1}),(0,T.of)({type:a.NX}).pipe((0,U.g)(0))):(0,Z.z)((0,T.of)({type:a.Ut,on:!0}),(0,T.of)({type:a.jV}).pipe((0,U.g)(q.RE)))).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.Jn)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t=o.cards.list,n=t[p.index];if(null!==n&&!1===P.includes(n.position)){const o=P.find((e=>t.every((p=>(null==p?void 0:p.position)!==e))));return void 0===o?(0,Z.z)((0,T.of)({type:a.kH}),(0,T.of)({type:a.Jn,index:p.index})).pipe((0,d.R)(e.ofType(a.OU))):(0,T.of)({type:a._d,index:p.index,toPosition:o}).pipe((0,d.R)(e.ofType(a.OU)))}return w.E})))),$.Z,j.Z,((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.qg)),(0,l.M)(p),(0,u.zg)((([e,p])=>{const{fromScreenEnd:o=!1}=e,t=p.multiplayer.on&&"connected_to_id"===p.multiplayer.status,n=p.multiplayer.gameNumber,i=!t||o&&-1===n?-1:(new Date).getTime(),r=Math.random()<.5,y=[],s=p.settings.cardsInHand;for(let e=0,p=2*s;e<p;e++){const p={position:e%s,n:(0,H.d)(),unusable:!1,discarded:!1,isFlipped:!1,zeroOpacity:!1,owner:e<s?"player":"opponent"};y.push(p)}return(0,Z.z)((0,T.of)({type:a.pS,playersTurn:r,cardList:y,gameNumber:i}),t?(0,T.of)({type:a.H8,kind:h.d,data:{type:o?a.S9:a.pS,playersTurn:!r,cardList:(0,z.b1)(y),gameNumber:i}}):w.E)})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.pS)),(0,l.M)(p),(0,u.zg)((([e,p])=>{const{playersTurn:o,cardList:t,gameNumber:n}=e,i=p.settings.cardsInHand,r={total:{player:i,opponent:i},list:t,nextPos:{player:i,opponent:i}};return(0,Z.z)((0,T.of)({type:a.Wz,payload:{type:null}}),(0,T.of)({type:a.OU}),(0,T.of)({type:a.zn,payload:r}),(0,T.of)({type:a.s3,playersTurn:o}),(0,T.of)({type:a.F5,payload:(0,J.iT)(p.settings)}),(0,T.of)({type:a.xD,n:n}),(0,T.of)({type:a.k4,owner:o?"player":"opponent"}),(0,T.of)({type:a.NX}).pipe((0,U.g)(0)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.S9)),(0,b.b)((e=>{const{type:p,prevGameNumber:o}=e,t=function(e,p){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&p.indexOf(t)<0&&(o[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(e);n<t.length;n++)p.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(o[t[n]]=e[t[n]])}return o}(e,["type","prevGameNumber"]);if(void 0===o)return void(0,N.Z)(`prevGameNumber is undefined in ${JSON.stringify(e)}`,"error");let n=v.YB.get(o);void 0===n&&(n=new R.Z,v.YB.set(o,n)),n.enqueue(t)})),(0,x.l)())),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.mv)),(0,l.M)(p),(0,u.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,N.Z)(`init from queue: ${n.toString()}`,"info");let i=v.YB.get(n);void 0===i&&(i=new R.Z,v.YB.set(n,i));const r=i.dequeueAsync();return(0,E.D)(r).pipe((0,l.M)(p),(0,u.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,T.of)(Object.assign({type:a.pS},e)).pipe((0,U.g)(0)):w.E)),(0,d.R)(e.ofType(a.Cv)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.NX)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t="connected_to_id"===o.multiplayer.status;let n;if(-1===o.multiplayer.gameNumber)n=(0,T.of)({type:a.kp,n:(0,H.d)()}).pipe((0,U.g)(0));else if(t){const e=(0,H.d)();n=(0,Z.z)((0,T.of)({type:a.kp,n:e}).pipe((0,U.g)(0)),(0,T.of)({type:a.H8,kind:h.d,data:{type:a.M0,n:e}}))}else n=(0,T.of)({type:a.tM}).pipe((0,U.g)(0));return(0,Z.z)((0,T.of)({type:a.Ut,on:!0,locknumber:1}),n).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.M0)),(0,b.b)((e=>{const{n:p,gameNumber:o}=e;if(void 0===o)return void(0,N.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let t=v.gZ.get(o);void 0===t&&(t=new R.Z,v.gZ.set(o,t)),t.enqueue(p)})),(0,x.l)())),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.tM)),(0,l.M)(p),(0,u.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,N.Z)(`draw card from queue: ${n.toString()}`,"info");let i=v.gZ.get(n);void 0===i&&(i=new R.Z,v.gZ.set(n,i));const r=i.dequeueAsync();return(0,E.D)(r).pipe((0,l.M)(p),(0,u.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,T.of)({type:a.kp,n:e}).pipe((0,U.g)(0)):w.E)),(0,d.R)(e.ofType(a.Cv)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.kp)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{n:t}=p,n=o.game.playersTurn?"player":"opponent",i=o.multiplayer.gameNumber;return(0,S.Z)("deal",o.volume),(0,N.Z)(`${n} draws card ${t}`,"info"),(0,Z.z)((0,T.of)({type:a.$Z,n:t}),(0,T.of)({type:a.Qo,lastOnly:!0}),(0,T.of)({type:a.B4,owner:n}).pipe((0,U.g)(q.Fi)),(0,T.of)({type:a.Ut,on:!1,locknumber:1}).pipe((0,U.g)(0)),"opponent"===n&&B.Hz&&-1===i?(0,T.of)({type:a.cx}).pipe((0,U.g)(q.RE+q.CF+(B.G1?0:B.kQ))):w.E,"opponent"===n&&i>0?(0,T.of)({type:a.tI}).pipe((0,U.g)(q.RE+q.t7)):w.E,"player"===n?(0,T.of)({type:a.yh}).pipe((0,U.g)(0)):w.E).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.jV)),(0,l.M)(p),(0,u.zg)((([p,o])=>(0,Z.z)((0,T.of)({type:a.K5}),(0,T.of)({type:a.k4,owner:o.game.playersTurn?"opponent":"player"}),(0,T.of)({type:a.Ut,on:!1}),(0,T.of)({type:a.NX}).pipe((0,U.g)(0)),(0,T.of)({type:a.Z$,on:!0})).pipe((0,d.R)(e.ofType(a.OU))))))),_.Z,((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.kH)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t=[],n=[],i=[];return D.forEach((e=>{o.cards.list.forEach(((p,o)=>{null!==p&&p.position===e&&(t.push((0,T.of)({type:a.EK,index:o})),n.push((0,T.of)({type:a.OK,index:o}).pipe((0,U.g)(q.RE))),i.push((0,T.of)({type:a.M2,index:o}).pipe((0,U.g)(2*q.RE))))}))})),(0,C.T)((0,T.of)({type:a.Z$,on:!1}),(0,C.T)(...t,...n,...i)).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.Qo)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t=[],n=[],i=(e,i)=>{if(null!==e){const r=p.lastOnly?o.game.playersTurn?"player":"opponent":e.owner;if("common"!==r){const{type:p,cost:y}=m.Z[e.n];o.status[r][O.ag[p]]<y?e.unusable||t.push(i):e.unusable&&n.push(i)}}};if(p.lastOnly){const e=o.cards.list,p=e.length-1;i(e[p],p)}else o.cards.list.forEach(i);return(0,T.of)({type:a.R9,unusables:t,usables:n}).pipe((0,d.R)(e.ofType(a.OU)))})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.Dt)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const{winTower:t,winResource:n}=(0,J.Ib)(o.settings),{player:i,opponent:r}=o.status,y=i.tower>=t||r.tower<=0||O.ag.some((e=>i[e]>=n)),s=r.tower>=t||i.tower<=0||O.ag.some((e=>r[e]>=n));return y&&!s?(0,T.of)({type:a.Wz,payload:{type:"win"}}).pipe((0,d.R)(e.ofType(a.OU))):!y&&s?(0,T.of)({type:a.Wz,payload:{type:"lose"}}).pipe((0,d.R)(e.ofType(a.OU))):y&&s?(0,T.of)({type:a.Wz,payload:{type:"tie"}}).pipe((0,d.R)(e.ofType(a.OU))):w.E})))),X.Z,I.Z,((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.cx)),(0,l.M)(p),(0,u.zg)((([p,o])=>{const t=(0,W.ai)(o);if(null===t)return(0,T.of)({type:a.Wz,payload:{type:"win",surrender:!0}}).pipe((0,d.R)(e.ofType(a.OU)));const{index:n,use:i}=t,r=o.cards.list[n];if(null!==r&&"common"!==r.owner){const{n:p,position:o,owner:t}=r;return i?(0,T.of)({type:a.qr,index:n,n:p,position:o,owner:t}).pipe((0,d.R)(e.ofType(a.OU))):(0,T.of)({type:a.fL,index:n,position:o,owner:t}).pipe((0,d.R)(e.ofType(a.OU)))}return w.E})))),((e,p)=>e.pipe((0,f.h)((0,g.isOfType)(a.yh)),(0,l.M)(p),(0,u.zg)((([p,o])=>0===(0,L.Z)(o,"player").filter((e=>e.canuse||e.candiscard)).length?(0,T.of)({type:a.Wz,payload:{type:"lose",surrender:!0}}).pipe((0,d.R)(e.ofType(a.OU))):w.E)))),F.Z,G.Z,Y.Z,A.Z,K.Z,Q.Z,V.Z,ee.Z,pe.Z,oe.Z,te.Z,ne.Z)}}]);