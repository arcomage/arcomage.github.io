"use strict";(self.webpackChunkarcomage_hd=self.webpackChunkarcomage_hd||[]).push([[8761],{17474:function(e,p,o){o.d(p,{Z:function(){return ye}});var t=o(84454),n=o(47515),i=o(77102),r=o(40706),y=o(93187),s=o(99592),a=o(23201),f=o(94132),l=o(63211),u=o(66008),d=o(43825),g=o(47746),c=o(1558),m=o(91757),O=o(96559),T=o(90583),Z=o(91304),w=o(18170),h=o(6353),z=o(5631),b=o(13875),x=o(66324),v=o(13068),N=o(26738),R=o(16306),U=o(17750),E=o(80127),M=o(55022),k=o(55760),S=o(55709),q=o(51015),P=o(71159),$=o(81317);const j=[-2,-3,-4];var H=o(76320),J=o(67032),B=o(5078),_=o(77456),C=o(23644),D=o(6709),X=o(14370);const I=[-2,-3,-4];var W=o(78373),L=o(74206),F=o(92119),G=o(40898),Y=o(84694),A=o(87878),K=o(37365),Q=o(78410),V=o(27360),ee=o(10228),pe=o(10441),oe=o(74555),te=o(92087),ne=o(62884),ie=o(60751),re=o(29970),ye=(0,t.l)(n.Z,i.Z,r.Z,y.Z,s.Z,a.Z,f.Z,((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.Uk)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t=o.status.player,n=o.status.opponent,i=Object.assign({},t),r=Object.assign({},n),y=T.Z[p.n],s="player"===p.owner?i:r,a=Z.ag[y.type];s[a]-=y.cost;const f=s[a],u=y.effect;"player"===p.owner?u(i,r):u(r,i);const d=(0,O.qh)(i).filter((([e,p])=>p!==t[e])).map((([e,o])=>({isPlayer:!0,statusProp:e,to:o,noSound:"player"===p.owner&&e===a&&o===f}))).concat((0,O.qh)(r).filter((([e,p])=>p!==n[e])).map((([e,o])=>({isPlayer:!1,statusProp:e,to:o,noSound:"opponent"===p.owner&&e===a&&o===f}))));return(0,w.of)({type:l.g$,payload:d}).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.qr)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{n:t,index:n,position:i,owner:r}=p,y=o.multiplayer.gameNumber;return(0,h.z)((0,w.of)({type:l.xZ,payload:{type:l.ao,n:t,index:n,position:i,owner:r}}),y>0?(0,w.of)({type:l.H8,kind:b.d,data:{type:l.u3,payload:{type:l.ao,n:t,index:n,position:i,owner:(0,x._w)(r)}}}):z.E).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.u3)),(0,v.b)((e=>{const{payload:p,gameNumber:o}=e;if(void 0===o)return void(0,U.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let t=R.PB.get(o);void 0===t&&(t=new E.Z,R.PB.set(o,t)),t.enqueue(p)})),(0,N.l)())),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.tI)),(0,d.M)(p),(0,g.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,U.Z)(`play card from queue: ${n.toString()}`,"info");let i=R.PB.get(n);void 0===i&&(i=new E.Z,R.PB.set(n,i));const r=i.dequeueAsync();return(0,k.D)(r).pipe((0,d.M)(p),(0,g.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,w.of)({type:l.xZ,payload:e}).pipe((0,M.g)(0)):z.E)),(0,c.R)(e.ofType(l.Cv)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.xZ)),(0,d.M)(p),(0,g.zg)((([o,t])=>{const{payload:n}=o;return t.game.locked.some((e=>!0===e))?((0,U.Z)(`${JSON.stringify(n)} executed during the lock ${JSON.stringify(t.game.locked)}. the game will try to fix that`,"warning"),p.pipe((0,S.U)((e=>e.game.locked)),(0,u.h)((e=>!e.some((e=>!0===e)))),(0,q.q)(1),(0,S.U)((()=>n)),(0,c.R)(e.ofType(l.Cv)))):(0,w.of)(n)})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.ao)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{n:t,index:n,position:i,owner:r}=p,y=T.Z[t].special;return(0,P.Z)("deal",o.volume),(0,h.z)(o.game.isNewTurn?(0,w.of)({type:l.kH}):z.E,(0,w.of)({type:l.Uk,n:t,owner:r}),(0,w.of)({type:l.PX,index:n}),(0,w.of)({type:l.fj,index:n,position:i,owner:r}),(0,w.of)({type:l.Ut,on:!0}),(null==y?void 0:y.drawDiscardPlayagain)?(0,h.z)((0,w.of)({type:l.vd,on:!0}),(0,w.of)({type:l.NX}).pipe((0,M.g)(0)),(0,w.of)({type:l.Jn,index:n}).pipe((0,M.g)($.RE+$.Oz)),(0,w.of)({type:l.Ut,on:!1})):(0,h.z)((0,w.of)({type:l.Jn,index:n}).pipe((0,M.g)($.RE+$.Oz)),(null==y?void 0:y.playagain)?(0,h.z)((0,w.of)({type:l.NX}).pipe((0,M.g)(0)),(0,w.of)({type:l.Ut,on:!1})):(0,w.of)({type:l.jV}).pipe((0,M.g)($.RE)))).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.fL)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{index:t,position:n,owner:i}=p,r=o.multiplayer.gameNumber;return(0,h.z)((0,w.of)({type:l.xZ,payload:{type:l.xr,index:t,position:n,owner:i}}),r>0?(0,w.of)({type:l.H8,kind:b.d,data:{type:l.u3,payload:{type:l.xr,index:t,position:n,owner:(0,x._w)(i)}}}):z.E).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.xr)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{index:t,position:n,owner:i}=p;return(0,P.Z)("deal",o.volume),(0,h.z)(o.game.isNewTurn?(0,w.of)({type:l.kH}):z.E,(0,w.of)({type:l.iE,index:t}),(0,w.of)({type:l.Jn,index:t}).pipe((0,M.g)(0)),(0,w.of)({type:l.fj,index:t,position:n,owner:i}),o.game.discardMode?(0,h.z)((0,w.of)({type:l.vd,on:!1}),(0,w.of)({type:l.NX}).pipe((0,M.g)(0))):(0,h.z)((0,w.of)({type:l.Ut,on:!0}),(0,w.of)({type:l.jV}).pipe((0,M.g)($.RE)))).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.Jn)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t=o.cards.list,n=t[p.index];if(null!==n&&!1===j.includes(n.position)){const o=j.find((e=>t.every((p=>(null==p?void 0:p.position)!==e))));return void 0===o?(0,h.z)((0,w.of)({type:l.kH}),(0,w.of)({type:l.Jn,index:p.index})).pipe((0,c.R)(e.ofType(l.OU))):(0,w.of)({type:l._d,index:p.index,toPosition:o}).pipe((0,c.R)(e.ofType(l.OU)))}return z.E})))),H.Z,J.Z,((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.qg)),(0,d.M)(p),(0,g.zg)((([e,p])=>{const{fromScreenEnd:o=!1}=e,t=p.multiplayer.on&&"connected_to_id"===p.multiplayer.status,n=p.multiplayer.gameNumber,i=!t||o&&-1===n?-1:(new Date).getTime(),r=Math.random()<.5,y=[],s=p.settings.cardsInHand;for(let e=0,p=2*s;e<p;e++){const p={position:e%s,n:(0,B.d)(),unusable:!1,discarded:!1,isFlipped:!1,zeroOpacity:!1,owner:e<s?"player":"opponent"};y.push(p)}return(0,h.z)((0,w.of)({type:l.pS,playersTurn:r,cardList:y,gameNumber:i}),t?(0,w.of)({type:l.H8,kind:b.d,data:{type:o?l.S9:l.pS,playersTurn:!r,cardList:(0,x.b1)(y),gameNumber:i}}):z.E)})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.pS)),(0,d.M)(p),(0,g.zg)((([e,p])=>{const{playersTurn:o,cardList:t,gameNumber:n}=e,i=p.settings.cardsInHand,r={total:{player:i,opponent:i},list:t,nextPos:{player:i,opponent:i}};return(0,h.z)((0,w.of)({type:l.Wz,payload:{type:null}}),(0,w.of)({type:l.OU}),(0,w.of)({type:l.zn,payload:r}),(0,w.of)({type:l.s3,playersTurn:o}),(0,w.of)({type:l.F5,payload:(0,_.iT)(p.settings)}),(0,w.of)({type:l.xD,n:n}),(0,w.of)({type:l.k4,owner:o?"player":"opponent"}),(0,w.of)({type:l.NX}).pipe((0,M.g)(0)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.S9)),(0,v.b)((e=>{const{type:p,prevGameNumber:o}=e,t=function(e,p){var o={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&p.indexOf(t)<0&&(o[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(e);n<t.length;n++)p.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(e,t[n])&&(o[t[n]]=e[t[n]])}return o}(e,["type","prevGameNumber"]);if(void 0===o)return void(0,U.Z)(`prevGameNumber is undefined in ${JSON.stringify(e)}`,"error");let n=R.YB.get(o);void 0===n&&(n=new E.Z,R.YB.set(o,n)),n.enqueue(t)})),(0,N.l)())),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.mv)),(0,d.M)(p),(0,g.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,U.Z)(`init from queue: ${n.toString()}`,"info");let i=R.YB.get(n);void 0===i&&(i=new E.Z,R.YB.set(n,i));const r=i.dequeueAsync();return(0,k.D)(r).pipe((0,d.M)(p),(0,g.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,w.of)(Object.assign({type:l.pS},e)).pipe((0,M.g)(0)):z.E)),(0,c.R)(e.ofType(l.Cv)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.NX)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t="connected_to_id"===o.multiplayer.status;let n;if(-1===o.multiplayer.gameNumber)n=(0,w.of)({type:l.kp,n:(0,B.d)()}).pipe((0,M.g)(0));else if(t){const e=(0,B.d)();n=(0,h.z)((0,w.of)({type:l.kp,n:e}).pipe((0,M.g)(0)),(0,w.of)({type:l.H8,kind:b.d,data:{type:l.M0,n:e}}))}else n=(0,w.of)({type:l.tM}).pipe((0,M.g)(0));return(0,h.z)((0,w.of)({type:l.Ut,on:!0,locknumber:1}),n).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.M0)),(0,v.b)((e=>{const{n:p,gameNumber:o}=e;if(void 0===o)return void(0,U.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let t=R.gZ.get(o);void 0===t&&(t=new E.Z,R.gZ.set(o,t)),t.enqueue(p)})),(0,N.l)())),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.tM)),(0,d.M)(p),(0,g.zg)((([o,t])=>{const{gameNumber:n}=t.multiplayer;(0,U.Z)(`draw card from queue: ${n.toString()}`,"info");let i=R.gZ.get(n);void 0===i&&(i=new E.Z,R.gZ.set(n,i));const r=i.dequeueAsync();return(0,k.D)(r).pipe((0,d.M)(p),(0,g.zg)((([e,p])=>p.multiplayer.gameNumber===n?(0,w.of)({type:l.kp,n:e}).pipe((0,M.g)(0)):z.E)),(0,c.R)(e.ofType(l.Cv)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.kp)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{n:t}=p,n=o.game.playersTurn?"player":"opponent",i=o.multiplayer.gameNumber;return(0,P.Z)("deal",o.volume),(0,U.Z)(`${n} draws card ${t}`,"info"),(0,h.z)((0,w.of)({type:l.$Z,n:t}),(0,w.of)({type:l.Qo,lastOnly:!0}),(0,w.of)({type:l.B4,owner:n}).pipe((0,M.g)($.Fi)),(0,w.of)({type:l.Ut,on:!1,locknumber:1}).pipe((0,M.g)(0)),"opponent"===n&&C.Hz&&-1===i?(0,w.of)({type:l.cx}).pipe((0,M.g)($.RE+$.CF+(C.G1?0:C.kQ))):z.E,"opponent"===n&&i>0?(0,w.of)({type:l.tI}).pipe((0,M.g)($.RE+$.t7)):z.E,"player"===n?(0,w.of)({type:l.yh}).pipe((0,M.g)(0)):z.E).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.jV)),(0,d.M)(p),(0,g.zg)((([p,o])=>(0,h.z)((0,w.of)({type:l.K5}),(0,w.of)({type:l.k4,owner:o.game.playersTurn?"opponent":"player"}),(0,w.of)({type:l.Ut,on:!1}),(0,w.of)({type:l.NX}).pipe((0,M.g)(0)),(0,w.of)({type:l.Z$,on:!0})).pipe((0,c.R)(e.ofType(l.OU))))))),D.Z,((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.kH)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t=[],n=[],i=[];return I.forEach((e=>{o.cards.list.forEach(((p,o)=>{null!==p&&p.position===e&&(t.push((0,w.of)({type:l.EK,index:o})),n.push((0,w.of)({type:l.OK,index:o}).pipe((0,M.g)($.RE))),i.push((0,w.of)({type:l.M2,index:o}).pipe((0,M.g)(2*$.RE))))}))})),(0,X.T)((0,w.of)({type:l.Z$,on:!1}),(0,X.T)(...t,...n,...i)).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.Qo)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t=[],n=[],i=(e,i)=>{if(null!==e){const r=p.lastOnly?o.game.playersTurn?"player":"opponent":e.owner;if("common"!==r){const{type:p,cost:y}=T.Z[e.n];o.status[r][Z.ag[p]]<y?e.unusable||t.push(i):e.unusable&&n.push(i)}}};if(p.lastOnly){const e=o.cards.list,p=e.length-1;i(e[p],p)}else o.cards.list.forEach(i);return(0,w.of)({type:l.R9,unusables:t,usables:n}).pipe((0,c.R)(e.ofType(l.OU)))})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.Dt)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const{winTower:t,winResource:n}=(0,_.Ib)(o.settings),{player:i,opponent:r}=o.status,y=i.tower>=t||r.tower<=0||Z.ag.some((e=>i[e]>=n)),s=r.tower>=t||i.tower<=0||Z.ag.some((e=>r[e]>=n));return y&&!s?(0,w.of)({type:l.Wz,payload:{type:"win"}}).pipe((0,c.R)(e.ofType(l.OU))):!y&&s?(0,w.of)({type:l.Wz,payload:{type:"lose"}}).pipe((0,c.R)(e.ofType(l.OU))):y&&s?(0,w.of)({type:l.Wz,payload:{type:"tie"}}).pipe((0,c.R)(e.ofType(l.OU))):z.E})))),W.Z,L.Z,((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.cx)),(0,d.M)(p),(0,g.zg)((([p,o])=>{const t=(0,F.ai)(o);if(null===t)return(0,w.of)({type:l.Wz,payload:{type:"win",surrender:!0}}).pipe((0,c.R)(e.ofType(l.OU)));const{index:n,use:i}=t,r=o.cards.list[n];if(null!==r&&"common"!==r.owner){const{n:p,position:o,owner:t}=r;return i?(0,w.of)({type:l.qr,index:n,n:p,position:o,owner:t}).pipe((0,c.R)(e.ofType(l.OU))):(0,w.of)({type:l.fL,index:n,position:o,owner:t}).pipe((0,c.R)(e.ofType(l.OU)))}return z.E})))),((e,p)=>e.pipe((0,u.h)((0,m.isOfType)(l.yh)),(0,d.M)(p),(0,g.zg)((([p,o])=>0===(0,G.Z)(o,"player").filter((e=>e.canuse||e.candiscard)).length?(0,w.of)({type:l.Wz,payload:{type:"lose",surrender:!0}}).pipe((0,c.R)(e.ofType(l.OU))):z.E)))),Y.Z,A.Z,K.Z,Q.Z,V.Z,ee.Z,pe.Z,oe.Z,te.Z,ne.Z,ie.Z,re.Z)}}]);