"use strict";(self.webpackChunkarcomage_hd=self.webpackChunkarcomage_hd||[]).push([[8761],{17474:(e,p,t)=>{t.d(p,{Z:()=>ae});var o=t(22915),n=t(47515),i=t(77102),r=t(40706),s=t(93187),a=t(99592),y=t(23201),l=t(94132),u=t(63211),f=t(94975),d=t(63428),c=t(43994),g=t(83505),m=t(91757),O=t(15069),Z=t(96559),w=t(90583),h=t(91304),z=t(32817),b=t(42034),x=t(1545),T=t(13875),v=t(66324),N=t(42006),R=t(20533),U=t(16306),E=t(17750),M=t(80127),k=t(45626),S=t(40052),q=t(29127),P=t(74727),$=t(71159),j=t(81317);const H=[-2,-3,-4];var J=t(76320),B=t(67032),_=t(5078),C=t(77456),D=t(23644),X=t(6709),I=t(23071);const W=[-2,-3,-4];var L=t(78373),F=t(74206),G=t(92119),Y=t(40898),A=t(84694),K=t(7668),Q=t(37365),V=t(78410),ee=t(27360),pe=t(10228),te=t(10441),oe=t(74555),ne=t(92087),ie=t(62884),re=t(60751),se=t(29970);const ae=(0,o.l)(n.Z,i.Z,r.Z,s.Z,a.Z,y.Z,l.Z,((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.Uk)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o=t.status.player,n=t.status.opponent,i=Object.assign({},o),r=Object.assign({},n),s=w.Z[p.n],a="player"===p.owner?i:r,y=h.ag[s.type];a[y]-=s.cost;const l=a[y],f=s.effect;"player"===p.owner?f(i,r):f(r,i);const d=(0,Z.qh)(i).filter((([e,p])=>p!==o[e])).map((([e,t])=>({isPlayer:!0,statusProp:e,to:t,noSound:"player"===p.owner&&e===y&&t===l}))).concat((0,Z.qh)(r).filter((([e,p])=>p!==n[e])).map((([e,t])=>({isPlayer:!1,statusProp:e,to:t,noSound:"opponent"===p.owner&&e===y&&t===l}))));return(0,z.of)({type:u.g$,payload:d}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.qr)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{n:o,index:n,position:i,owner:r}=p,s=t.multiplayer.gameNumber;return(0,b.z)((0,z.of)({type:u.xZ,payload:{type:u.ao,n:o,index:n,position:i,owner:r}}),s>0?(0,z.of)({type:u.H8,kind:T.d,data:{type:u.u3,payload:{type:u.ao,n:o,index:n,position:i,owner:(0,v._w)(r)}}}):x.E).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.u3)),(0,N.b)((e=>{const{payload:p,gameNumber:t}=e;if(void 0===t)return void(0,E.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let o=U.PB.get(t);void 0===o&&(o=new M.Z,U.PB.set(t,o)),o.enqueue(p)})),(0,R.l)())),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.tI)),(0,d.M)(p),(0,c.z)((([t,o])=>{const{gameNumber:n}=o.multiplayer;(0,E.Z)(`play card from queue: ${n.toString()}`,"info");let i=U.PB.get(n);void 0===i&&(i=new M.Z,U.PB.set(n,i));const r=i.dequeueAsync();return(0,S.D)(r).pipe((0,d.M)(p),(0,c.z)((([e,p])=>p.multiplayer.gameNumber===n?(0,z.of)({type:u.xZ,payload:e}).pipe((0,k.g)(0)):x.E)),(0,g.R)(e.pipe((0,O.l)(u.Cv))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.xZ)),(0,d.M)(p),(0,c.z)((([t,o])=>{const{payload:n}=t;return o.game.locked.some((e=>!0===e))?((0,E.Z)(`${JSON.stringify(n)} executed during the lock ${JSON.stringify(o.game.locked)}. the game will try to fix that`,"warning"),p.pipe((0,q.U)((e=>e.game.locked)),(0,f.h)((e=>!e.some((e=>!0===e)))),(0,P.q)(1),(0,q.U)((()=>n)),(0,g.R)(e.pipe((0,O.l)(u.Cv))))):(0,z.of)(n)})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.ao)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{n:o,index:n,position:i,owner:r}=p,s=w.Z[o].special;return(0,$.Z)("deal",t.volume),(0,b.z)(t.game.isNewTurn?(0,z.of)({type:u.kH}):x.E,(0,z.of)({type:u.Uk,n:o,owner:r}),(0,z.of)({type:u.PX,index:n}),(0,z.of)({type:u.fj,index:n,position:i,owner:r}),(0,z.of)({type:u.Ut,on:!0}),(null==s?void 0:s.drawDiscardPlayagain)?(0,b.z)((0,z.of)({type:u.vd,on:!0}),(0,z.of)({type:u.NX}).pipe((0,k.g)(0)),(0,z.of)({type:u.Jn,index:n}).pipe((0,k.g)(j.RE+j.Oz)),(0,z.of)({type:u.Ut,on:!1})):(0,b.z)((0,z.of)({type:u.Jn,index:n}).pipe((0,k.g)(j.RE+j.Oz)),(null==s?void 0:s.playagain)?(0,b.z)((0,z.of)({type:u.NX}).pipe((0,k.g)(0)),(0,z.of)({type:u.Ut,on:!1})):(0,z.of)({type:u.jV}).pipe((0,k.g)(j.RE)))).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.fL)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{index:o,position:n,owner:i}=p,r=t.multiplayer.gameNumber;return(0,b.z)((0,z.of)({type:u.xZ,payload:{type:u.xr,index:o,position:n,owner:i}}),r>0?(0,z.of)({type:u.H8,kind:T.d,data:{type:u.u3,payload:{type:u.xr,index:o,position:n,owner:(0,v._w)(i)}}}):x.E).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.xr)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{index:o,position:n,owner:i}=p;return(0,$.Z)("deal",t.volume),(0,b.z)(t.game.isNewTurn?(0,z.of)({type:u.kH}):x.E,(0,z.of)({type:u.iE,index:o}),(0,z.of)({type:u.Jn,index:o}).pipe((0,k.g)(0)),(0,z.of)({type:u.fj,index:o,position:n,owner:i}),t.game.discardMode?(0,b.z)((0,z.of)({type:u.vd,on:!1}),(0,z.of)({type:u.NX}).pipe((0,k.g)(0))):(0,b.z)((0,z.of)({type:u.Ut,on:!0}),(0,z.of)({type:u.jV}).pipe((0,k.g)(j.RE)))).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.Jn)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o=t.cards.list,n=o[p.index];if(null!==n&&!1===H.includes(n.position)){const t=H.find((e=>o.every((p=>(null==p?void 0:p.position)!==e))));return void 0===t?(0,b.z)((0,z.of)({type:u.kH}),(0,z.of)({type:u.Jn,index:p.index})).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):(0,z.of)({type:u._d,index:p.index,toPosition:t}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))}return x.E})))),J.Z,B.Z,((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.qg)),(0,d.M)(p),(0,c.z)((([e,p])=>{const{fromScreenEnd:t=!1}=e,o=p.multiplayer.on&&"connected_to_id"===p.multiplayer.status,n=p.multiplayer.gameNumber,i=!o||t&&-1===n?-1:(new Date).getTime(),r=Math.random()<.5,s=[],a=p.settings.cardsInHand;for(let e=0,p=2*a;e<p;e++){const p={position:e%a,n:(0,_.d)(),unusable:!1,discarded:!1,isFlipped:!1,zeroOpacity:!1,owner:e<a?"player":"opponent"};s.push(p)}return(0,b.z)((0,z.of)({type:u.pS,playersTurn:r,cardList:s,gameNumber:i}),o?(0,z.of)({type:u.H8,kind:T.d,data:{type:t?u.S9:u.pS,playersTurn:!r,cardList:(0,v.b1)(s),gameNumber:i}}):x.E)})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.pS)),(0,d.M)(p),(0,c.z)((([e,p])=>{const{playersTurn:t,cardList:o,gameNumber:n}=e,i=p.settings.cardsInHand,r={total:{player:i,opponent:i},list:o,nextPos:{player:i,opponent:i}};return(0,b.z)((0,z.of)({type:u.Wz,payload:{type:null}}),(0,z.of)({type:u.OU}),(0,z.of)({type:u.zn,payload:r}),(0,z.of)({type:u.s3,playersTurn:t}),(0,z.of)({type:u.F5,payload:(0,C.iT)(p.settings)}),(0,z.of)({type:u.xD,n}),(0,z.of)({type:u.k4,owner:t?"player":"opponent"}),(0,z.of)({type:u.NX}).pipe((0,k.g)(0)))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.S9)),(0,N.b)((e=>{const{type:p,prevGameNumber:t}=e,o=function(e,p){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&p.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)p.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(t[o[n]]=e[o[n]])}return t}(e,["type","prevGameNumber"]);if(void 0===t)return void(0,E.Z)(`prevGameNumber is undefined in ${JSON.stringify(e)}`,"error");let n=U.YB.get(t);void 0===n&&(n=new M.Z,U.YB.set(t,n)),n.enqueue(o)})),(0,R.l)())),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.mv)),(0,d.M)(p),(0,c.z)((([t,o])=>{const{gameNumber:n}=o.multiplayer;(0,E.Z)(`init from queue: ${n.toString()}`,"info");let i=U.YB.get(n);void 0===i&&(i=new M.Z,U.YB.set(n,i));const r=i.dequeueAsync();return(0,S.D)(r).pipe((0,d.M)(p),(0,c.z)((([e,p])=>p.multiplayer.gameNumber===n?(0,z.of)(Object.assign({type:u.pS},e)).pipe((0,k.g)(0)):x.E)),(0,g.R)(e.pipe((0,O.l)(u.Cv))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.NX)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o="connected_to_id"===t.multiplayer.status;let n;if(-1===t.multiplayer.gameNumber)n=(0,z.of)({type:u.kp,n:(0,_.d)()}).pipe((0,k.g)(0));else if(o){const e=(0,_.d)();n=(0,b.z)((0,z.of)({type:u.kp,n:e}).pipe((0,k.g)(0)),(0,z.of)({type:u.H8,kind:T.d,data:{type:u.M0,n:e}}))}else n=(0,z.of)({type:u.tM}).pipe((0,k.g)(0));return(0,b.z)((0,z.of)({type:u.Ut,on:!0,locknumber:1}),n).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.M0)),(0,N.b)((e=>{const{n:p,gameNumber:t}=e;if(void 0===t)return void(0,E.Z)(`gameNumber is undefined in ${JSON.stringify(e)}`,"error");let o=U.gZ.get(t);void 0===o&&(o=new M.Z,U.gZ.set(t,o)),o.enqueue(p)})),(0,R.l)())),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.tM)),(0,d.M)(p),(0,c.z)((([t,o])=>{const{gameNumber:n}=o.multiplayer;(0,E.Z)(`draw card from queue: ${n.toString()}`,"info");let i=U.gZ.get(n);void 0===i&&(i=new M.Z,U.gZ.set(n,i));const r=i.dequeueAsync();return(0,S.D)(r).pipe((0,d.M)(p),(0,c.z)((([e,p])=>p.multiplayer.gameNumber===n?(0,z.of)({type:u.kp,n:e}).pipe((0,k.g)(0)):x.E)),(0,g.R)(e.pipe((0,O.l)(u.Cv))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.kp)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{n:o}=p,n=t.game.playersTurn?"player":"opponent",i=t.multiplayer.gameNumber;return(0,$.Z)("deal",t.volume),(0,E.Z)(`${n} draws card ${o}`,"info"),(0,b.z)((0,z.of)({type:u.$Z,n:o}),(0,z.of)({type:u.Qo,lastOnly:!0}),(0,z.of)({type:u.B4,owner:n}).pipe((0,k.g)(j.Fi)),(0,z.of)({type:u.Ut,on:!1,locknumber:1}).pipe((0,k.g)(0)),"opponent"===n&&D.Hz&&-1===i?(0,z.of)({type:u.cx}).pipe((0,k.g)(j.RE+j.CF+(D.G1?0:D.kQ))):x.E,"opponent"===n&&i>0?(0,z.of)({type:u.tI}).pipe((0,k.g)(j.RE+j.t7)):x.E,"player"===n?(0,z.of)({type:u.yh}).pipe((0,k.g)(0)):x.E).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.jV)),(0,d.M)(p),(0,c.z)((([p,t])=>(0,b.z)((0,z.of)({type:u.K5}),(0,z.of)({type:u.k4,owner:t.game.playersTurn?"opponent":"player"}),(0,z.of)({type:u.Ut,on:!1}),(0,z.of)({type:u.NX}).pipe((0,k.g)(0)),(0,z.of)({type:u.Z$,on:!0})).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))))))),X.Z,((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.kH)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o=[],n=[],i=[];return W.forEach((e=>{t.cards.list.forEach(((p,t)=>{null!==p&&p.position===e&&(o.push((0,z.of)({type:u.EK,index:t})),n.push((0,z.of)({type:u.OK,index:t}).pipe((0,k.g)(j.RE))),i.push((0,z.of)({type:u.M2,index:t}).pipe((0,k.g)(2*j.RE))))}))})),(0,I.T)((0,z.of)({type:u.Z$,on:!1}),(0,I.T)(...o,...n,...i)).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.Qo)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o=[],n=[],i=(e,i)=>{if(null!==e){const r=p.lastOnly?t.game.playersTurn?"player":"opponent":e.owner;if("common"!==r){const{type:p,cost:s}=w.Z[e.n];t.status[r][h.ag[p]]<s?e.unusable||o.push(i):e.unusable&&n.push(i)}}};if(p.lastOnly){const e=t.cards.list,p=e.length-1;i(e[p],p)}else t.cards.list.forEach(i);return(0,z.of)({type:u.R9,unusables:o,usables:n}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.Dt)),(0,d.M)(p),(0,c.z)((([p,t])=>{const{winTower:o,winResource:n}=(0,C.Ib)(t.settings),{player:i,opponent:r}=t.status,s=i.tower>=o||r.tower<=0||h.ag.some((e=>i[e]>=n)),a=r.tower>=o||i.tower<=0||h.ag.some((e=>r[e]>=n));return s&&!a?(0,z.of)({type:u.Wz,payload:{type:"win"}}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):!s&&a?(0,z.of)({type:u.Wz,payload:{type:"lose"}}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):s&&a?(0,z.of)({type:u.Wz,payload:{type:"tie"}}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):x.E})))),L.Z,F.Z,((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.cx)),(0,d.M)(p),(0,c.z)((([p,t])=>{const o=(0,G.ai)(t);if(null===o)return(0,z.of)({type:u.Wz,payload:{type:"win",surrender:!0}}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))));const{index:n,use:i}=o,r=t.cards.list[n];if(null!==r&&"common"!==r.owner){const{n:p,position:t,owner:o}=r;return i?(0,z.of)({type:u.qr,index:n,n:p,position:t,owner:o}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):(0,z.of)({type:u.fL,index:n,position:t,owner:o}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU))))}return x.E})))),((e,p)=>e.pipe((0,f.h)((0,m.isOfType)(u.yh)),(0,d.M)(p),(0,c.z)((([p,t])=>0===(0,Y.Z)(t,"player").filter((e=>e.canuse||e.candiscard)).length?(0,z.of)({type:u.Wz,payload:{type:"lose",surrender:!0}}).pipe((0,g.R)(e.pipe((0,O.l)(u.OU)))):x.E)))),A.Z,K.Z,Q.Z,V.Z,ee.Z,pe.Z,te.Z,oe.Z,ne.Z,ie.Z,re.Z,se.Z)}}]);